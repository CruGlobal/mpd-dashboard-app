!function(){"use strict";angular.module("mpdDashboard",["gettext","ui.router","angular-growl","cas-auth-api","mpdDashboard.settingsService","mpdDashboard.states.dashboard.countries"])}(),function(t){"use strict";t.config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/countries"),t.state("app",{"abstract":!0,url:"/",resolve:{user:["$log","$q","$state","User",function(t,e,o,r){return r.get().$promise}]},templateUrl:"app/states/app.html"})}])}(angular.module("mpdDashboard.states.app",["ui.router","angular-growl","ui.bootstrap.collapse","ui.bootstrap.dropdown","mpdDashboard.api.user","mpdDashboard.states.unauthorized"])),function(t){"use strict";t.config(["$stateProvider",function(t){t.state("dashboard",{"abstract":!0,parent:"app",url:"?estimated",resolve:{permissions:["$q","$state","user",function(t,e,o){var r=t.defer(),a=0!==o.attributes.permissions.countries.length,n=0!==o.attributes.permissions.accounts.length;return a||n?r.resolve(o.attributes.permissions):(e.go("unauthorized"),r.reject("unauthorized")),r.promise}],estimated:["$stateParams",function(t){return{estimated:"false"===t.estimated?!1:!0}}]},views:{"footer@app":{template:'<div ng-if="estimated.estimated" class="alert alert-estimated">*Based on estimated budget(s)</div>',controller:["$scope","estimated",function(t,e){t.estimated=e}]},"navbarForm@app":{templateUrl:"app/states/dashboard/estimated-toggle.html",controller:"EstimatedToggleController as toggle"},"navigation@app":{templateUrl:"app/states/dashboard/navigation.html",controller:"NavigationController as nav"}},params:{estimated:{value:"true",squash:!0}}})}])}(angular.module("mpdDashboard.states.dashboard",["ui.router","angular-growl","ui.bootstrap.buttons","mpdDashboard.api.user","mpdDashboard.states.app"])),function(t){"use strict";t.config(["$stateProvider",function(t){t.state("unauthorized",{parent:"app",url:"",resolve:{permissions:["$q","$state","User",function(t,e,o){var r=t.defer();return o.get().$promise.then(function(t){var o=_.sortBy(t.attributes.permissions.countries,"name"),a=_.sortBy(t.attributes.permissions.accounts,"name");if(0===o.length&&0===a.length)r.resolve(!0);else if(0!==o.length)if(1===o.length){var n=_.first(o);e.go("country",{id:n.id})}else e.go("countries");else{var s=_.first(a);e.go("staffAccount",{id:s.id})}},function(){r.resolve(!0)}),r.promise}]},views:{"@app":{templateUrl:"app/states/unauthorized/unauthorized.html",controller:["$scope","permissions","$stateParams",function(t,e,o){console.log(o),t.message=angular.isDefined(o.message)?o.message:void 0}]}},params:{message:null}})}])}(angular.module("mpdDashboard.states.unauthorized",["ui.router","angular-growl","mpdDashboard.states.app","mpdDashboard.states.dashboard.countries","mpdDashboard.states.dashboard.staffAccount","mpdDashboard.states.dashboard.country"])),function(t){"use strict";t.config(["$stateProvider",function(t){t.state("countries",{parent:"dashboard",url:"countries",resolve:{hasCountries:["$state","permissions",function(t,e){return 0===e.countries.length&&t.go("unauthorized"),e.countries}],countries:["$log","$q","$state","Countries","estimated","hasCountries",function(t,e,o,r,a,n){var s=e.defer();return r.query(a.estimated?{estimated:!0}:{}).$promise.then(function(t){s.resolve(t)},function(){o.go("unauthorized")}),s.promise}],geodata:["$log","$filter","countries",function(t,e,o){var r=_.reject(_.pluck(o,"attributes"),function(t){return angular.isUndefined(t.iso_code)||_.isNull(t.iso_code)||""===t.iso_code}),a=["Country"].concat(_.pluck(r,"iso_code")),n=["MPD Level"].concat(_.map(_.pluck(r,"mpd_level"),function(t){return e("percent")(t,2,!1)}));return _.zip(a,n)}]},views:{"@app":{templateUrl:"app/states/dashboard/countries/countries.html",controller:"CountriesController as countries"}}})}])}(angular.module("mpdDashboard.states.dashboard.countries",["ui.router","angular-growl","googlechart","mpdDashboard.components.googlechart.regionClick","mpdDashboard.components.percent","mpdDashboard.api.countries","mpdDashboard.states.dashboard","mpdDashboard.states.dashboard.country","mpdDashboard.states.unauthorized"])),function(t){"use strict";t.config(["$stateProvider",function(t){t.state("country",{parent:"dashboard",url:"country/{id:int}",resolve:{hasCountry:["$state","$stateParams","permissions",function(t,e,o){var r=_.findWhere(o.countries,{id:e.id});return angular.isUndefined(r)&&t.go("unauthorized"),r}],country:["$q","$state","$stateParams","Countries","estimated","hasCountry",function(t,e,o,r,a,n){var s=t.defer();return r.get(a.estimated?{id:o.id,estimated:!0}:{id:o.id}).$promise.then(function(t){s.resolve(t)},function(){e.go("unauthorized")}),s.promise}],mpdHealthData:["country",function(t){return[["Support Level","Percentage Raised"],["> 100%",t.attributes.mpd_health[0].length],["80 - 100%",t.attributes.mpd_health[1].length],["50 - 80%",t.attributes.mpd_health[2].length],["< 50%",t.attributes.mpd_health[3].length],["No Budget",t.attributes.mpd_health[4].length]]}],supportTrendData:["$window","$q","googleChartApiPromise","country",function(t,e,o,r){var a=e.defer();return o.then(function(){var e=_.map(r.attributes.average_support,function(t){return t[0]=new Date(t[0]),t}),o=t.google.visualization.arrayToDataTable([["Period","Average Support Level","Staff with more than 90%"]].concat(e)),n=new t.google.visualization.DateFormat({pattern:"MMM y"});n.format(o,0);var s=new t.google.visualization.NumberFormat({pattern:"#,###%",fractionDigits:2});s.format(o,1),s.format(o,2),a.resolve(o)},function(){a.reject()}),a.promise}]},views:{"@app":{templateUrl:"app/states/dashboard/country/country.html",controller:"CountryController as country"},"title@app":{template:"<span>{{name}}</span>",controller:["$scope","country",function(t,e){t.name=e.attributes.name}]}}})}])}(angular.module("mpdDashboard.states.dashboard.country",["ui.router","angular-growl","googlechart","mpdDashboard.components.percent","mpdDashboard.api.countries","mpdDashboard.states.dashboard","mpdDashboard.states.dashboard.staffAccount","mpdDashboard.states.unauthorized"])),function(t){"use strict";t.config(["$stateProvider",function(t){t.state("staffAccount",{parent:"dashboard",url:"staff/{id:int}",resolve:{account:["$q","$state","$stateParams","Staff","estimated","permissions",function(t,e,o,r,a,n){var s=t.defer();return r.get(a.estimated?{id:o.id,estimated:!0}:{id:o.id}).$promise.then(function(t){s.resolve(t)},function(){e.go("unauthorized")}),s.promise}],budgetTrendData:["$window","$q","googleChartApiPromise","account",function(t,e,o,r){var a=e.defer();return o.then(function(){var e=_.map(r.attributes.budget_trend,function(t){return t[0]=new Date(t[0]),t}),o=t.google.visualization.arrayToDataTable([["Month","Balance","Income","To Raise","Expenses","Expense Budget"]].concat(e)),n=new t.google.visualization.DateFormat({pattern:"MMM y"});n.format(o,0),a.resolve(o)},function(){a.reject()}),a.promise}],incomeBreakdownData:["account",function(t){return[["Income Type","Amount"]].concat(t.attributes.income)}]},views:{"@app":{templateUrl:"app/states/dashboard/staff-account/staff-account.html",controller:"StaffAccountController as staffAccountCtrl"},"title@app":{template:"<span>{{name}}</span>",controller:["$scope","account",function(t,e){t.name=e.attributes.name}]}}})}])}(angular.module("mpdDashboard.states.dashboard.staffAccount",["ui.router","angular-growl","googlechart","ui.bootstrap.dropdown","mpdDashboard.components.percent","mpdDashboard.api.staff","mpdDashboard.states.dashboard.country","mpdDashboard.states.unauthorized"])),function(t){"use strict";t.config(["$locationProvider",function(t){t.html5Mode(!0)}]),t.config(["SettingsProvider",function(t){t.setConfig(window.MPDDashboard.config)}]),t.config(["$logProvider","SettingsProvider",function(t,e){t.debugEnabled(e.isDevelopment())}]),t.config(["casAuthApiProvider","SettingsProvider",function(t,e){t.setRequireAccessToken(!0).setCacheAccessToken(!0).setAuthenticationApiBaseUrl(e.casAuthApiBaseUrl()).setTicketUrl(e.ticketUrl())}]),t.config(["growlProvider",function(t){t.globalPosition("top-right"),t.globalDisableCountDown(!0),t.globalTimeToLive({success:1e4,error:-1,warning:-1,info:1e4})}]),t.run(["casAuthApi","Settings",function(t,e){t.addManagedApi(e.api.mpdDashboard())}]),t.run(["$log","$rootScope",function(t,e){e.$on("$stateChangeStart",function(){angular.element("div.loading").removeClass("hide")}),e.$on("$stateChangeSuccess",function(){angular.element("div.loading").addClass("hide")}),e.$on("$stateChangeError",function(e,o,r,a,n,s){t.error("$stateChangeError:",o,r,s)})}])}(angular.module("mpdDashboard")),function(t){"use strict";t.factory("Countries",["$log","$resource","Settings",function(t,e,o){var r=function(t){return t.data.data};return e(o.api.mpdDashboard("/countries/:id"),{},{query:{method:"GET",interceptor:{response:r}},get:{method:"GET",interceptor:{response:r}}})}])}(angular.module("mpdDashboard.api.countries",["ngResource"])),function(t){"use strict";t.factory("Staff",["$log","$resource","Settings",function(t,e,o){var r=function(t){return t.data.data};return e(o.api.mpdDashboard("/staff/:id"),{},{get:{method:"GET",interceptor:{response:r}},remove:{method:"DELETE",interceptor:{response:r}}})}])}(angular.module("mpdDashboard.api.staff",["ngResource"])),function(t){"use strict";t.factory("User",["$log","$resource","Settings",function(t,e,o){var r=function(t){return t.data.data};return e(o.api.mpdDashboard("/user"),{},{get:{method:"GET",interceptor:{response:r}}})}])}(angular.module("mpdDashboard.api.user",["ngResource"])),function(t){"use strict";t.filter("percent",["$window",function(t){return function(e,o,r){return o=angular.isNumber(o)?o:2,angular.isUndefined(r)&&(r="%"),t.isNaN(e)?"":Math.round(e*Math.pow(10,o+2))/Math.pow(10,o)+(r?r:0)}}])}(angular.module("mpdDashboard.components.percent",[])),function(t){"use strict";t.provider("Settings",function(){function t(t,e){return"undefined"==typeof e?t:0===e.indexOf("/")?t+e:t+"/"+e}var e={};this.setConfig=function(t){e=t},this.isDevelopment=function(){return"development"===e.environment},this.casAuthApiBaseUrl=function(){return e.api.casAuthApi},this.ticketUrl=function(){return e.api.refresh},this.$get=function(){return{api:{mpdDashboard:function(o){return t(e.api.mpdDashboard,o)}}}}})}(angular.module("mpdDashboard.settingsService",[])),function(t){"use strict";t.directive("regionClick",["$log",function(t){return{restrict:"A",scope:!1,require:"googleChart",link:function(t,e,o,r){function a(e,r,n){a.$inject=["chartWrapper","chart","args"];var s={chartWrapper:e,chart:r,args:n,region:n[0].region};t.$apply(function(){t.$eval(o.regionClick,s)})}r.registerChartListener("regionClick",a,this)}}}])}(angular.module("mpdDashboard.components.googlechart.regionClick",["googlechart"])),function(t){"use strict";function e(t,e,o){var r=this;this.model=o,t.$watch(function(t){return r.model.estimated},function(t,o){e.go(e.current,{estimated:t})})}e.$inject=["$scope","$state","estimated"],t.controller("EstimatedToggleController",e)}(angular.module("mpdDashboard.states.dashboard")),function(t){"use strict";function e(t,e,o){this.$state=e,this.countries=o.countries,this.accounts=o.accounts}e.$inject=["$log","$state","permissions"],t.controller("NavigationController",e)}(angular.module("mpdDashboard.states.dashboard")),function(t){"use strict";function e(t,e,o,r,a){this.$state=o,this.countries=r,this.geochart={type:"GeoChart",data:a,options:{backgroundColor:e.jQuery(".dashboard-well").css("backgroundColor"),colorAxis:{minValue:50,maxValue:100,colors:[e.jQuery(".countries-geochart-colors .danger").css("backgroundColor"),e.jQuery(".countries-geochart-colors .warning").css("backgroundColor"),e.jQuery(".countries-geochart-colors .success").css("backgroundColor")]}}}}e.$inject=["$log","$window","$state","countries","geodata"],e.prototype.onReady=function(t){jQuery(t.getContainerId()).find("svg").each(function(){jQuery(this).find("g").each(function(){if(jQuery(this).attr("clip-path")){if(-1==jQuery(this).attr("clip-path").indexOf("url(#"))return;jQuery(this).attr("clip-path","url("+document.location+jQuery(this).attr("clip-path").substring(4))}}),jQuery(this).find("rect").each(function(){if(jQuery(this).attr("fill")){if(-1==jQuery(this).attr("fill").indexOf("url(#"))return;jQuery(this).attr("fill","url("+document.location+jQuery(this).attr("fill").substring(4))}})})},e.prototype.onRegionClick=function(t){var e=_.filter(this.countries,function(e){return e.attributes.iso_code===t}).pop();angular.isDefined(e)&&this.$state.go("country",{id:e.id})},t.controller("CountriesController",e)}(angular.module("mpdDashboard.states.dashboard.countries")),function(t){"use strict";function e(t,e,o,r,a,n){this.$state=o,this.mpdHealth={type:"PieChart",data:r,options:{pieHole:.4,reverseCategories:!1,chartArea:{left:60,top:20,width:"120%",height:"90%"},legend:{textStyle:{color:"white"}},backgroundColor:e.jQuery(".mpd-health").css("backgroundColor"),pieSliceBorderColor:e.jQuery(".mpd-health").css("backgroundColor"),slices:[{color:e.jQuery(".mpd-health .chart-colors .color1").css("backgroundColor")},{color:e.jQuery(".mpd-health .chart-colors .color2").css("backgroundColor")},{color:e.jQuery(".mpd-health .chart-colors .color3").css("backgroundColor")},{color:e.jQuery(".mpd-health .chart-colors .color4").css("backgroundColor")},{color:e.jQuery(".mpd-health .chart-colors .color5").css("backgroundColor")}]}},this.supportTrend={type:"LineChart",data:a,options:{legend:{textStyle:{color:"white"}},backgroundColor:e.jQuery(".support-trend").css("backgroundColor"),colors:[e.jQuery(".support-trend .chart-colors .color1").css("backgroundColor"),e.jQuery(".support-trend .chart-colors .color2").css("backgroundColor")],lineWidth:3,pointSize:4,hAxis:{baselineColor:"white",format:"MMM y",textStyle:{color:"white"}},vAxis:{baselineColor:"white",format:"percent",textStyle:{color:"white"}}}},this.onMpdHealthSelect=function(t){angular.isUndefined(t)?delete this.staff:(this.staffHeading=r[t.row+1][0],this.staff=n.attributes.mpd_health[t.row])}}e.$inject=["$log","$window","$state","mpdHealthData","supportTrendData","country"],t.controller("CountryController",e)}(angular.module("mpdDashboard.states.dashboard.country")),function(t){"use strict";function e(t,e,o,r,a,n,s){var i=e.jQuery(".budget-trend"),u=e.jQuery(".income-breakdown"),c=i.css("backgroundColor"),d=i.css("color"),l=[i.find(".color1").css("backgroundColor"),i.find(".color2").css("backgroundColor"),i.find(".color3").css("backgroundColor"),i.find(".color4").css("backgroundColor"),i.find(".color5").css("backgroundColor")],p=[u.find(".color1").css("backgroundColor"),u.find(".color2").css("backgroundColor"),u.find(".color3").css("backgroundColor")];this.$state=o,this.mpdAnalysis=r.attributes.mpd_analysis,this.averageSupport=r.attributes.average_support,this.incorrect_association=r.attributes.incorrect_association,this.budgetTrend={type:"LineChart",data:a,view:{columns:[0,1,2,3,4,5]},options:{legend:{textStyle:{color:"white"}},backgroundColor:c,colors:angular.copy(l),lineWidth:3,series:{2:{lineDashStyle:[10,6]},4:{lineDashStyle:[10,6]}},hAxis:{baselineColor:d,textStyle:{color:d}},vAxis:{baselineColor:d,textStyle:{color:d}}}},this.hideTrendSeries=function(t){if(!angular.isUndefined(t)){var e=t.column;null===t.row&&(this.budgetTrend.view.columns[e]==e?(this.budgetTrend.view.columns[e]={label:a.getColumnLabel(e),type:a.getColumnType(e),calc:function(){return null}},this.budgetTrend.options.colors[e-1]="#CCCCCC"):(this.budgetTrend.view.columns[e]=e,this.budgetTrend.options.colors[e-1]=l[e-1]))}},this.incomeBreakdown={type:"PieChart",data:n,options:{pieHole:.4,reverseCategories:!1,chartArea:{left:60,top:20,width:"120%",height:"90%"},legend:{textStyle:{color:d}},backgroundColor:c,pieSliceBorderColor:c,slices:[{color:p[0]},{color:p[1]},{color:p[2]}]}},this.reportIncorrectAssociation=function(){var t=this;s.remove({id:r.id}).$promise.then(function(e){t.incorrect_association=!0},function(){})}}e.$inject=["$log","$window","$state","account","budgetTrendData","incomeBreakdownData","Staff"],t.controller("StaffAccountController",e)}(angular.module("mpdDashboard.states.dashboard.staffAccount"));
//# sourceMappingURL=app.min.js.map
